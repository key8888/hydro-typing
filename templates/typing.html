{% extends "layout/basic.html" %}
{% block content %}

<!-- Â§ñÈÉ®CSS -->
<link rel="stylesheet" href="/public/typing.css">

<div class="row">
  <div class="medium-12 columns">
    <!-- „Çø„Ç§„Éî„É≥„Ç∞Êú¨‰Ωì -->
    <div class="section">
      <div class="section__header">
        <h1 class="section__title">{{ _('Typing Practice') }}</h1>
      </div>

      <div class="section__body typing-wrap">
        <!-- üîä „Éà„Ç∞„É´ -->
        <div style="position:absolute; right:.5rem; top:-.25rem; font-size:.9rem; color:#666;">
          <label style="cursor:pointer; user-select:none;">
            <input id="tts-toggle" type="checkbox" checked style="vertical-align:middle; margin-right:.25rem;">
            üîä Áô∫Èü≥
          </label>
        </div>

        <!-- ÊÆã„ÇäÂçòË™ûÊï∞ HUD -->
        <div id="hud-remaining" class="typing-hud">Left: - / -</div>

        <!-- ÂçòË™ûË°®Á§∫ -->
        <div id="word-display" class="typing-word"></div>

        <!-- Êó•Êú¨Ë™ûË®≥ -->
        <div id="meaning-display" class="typing-meaning"></div>

        <!-- ÁµÇ‰∫ÜÁîªÈù¢ -->
        <div id="end-screen" class="typing-end">
          <h2 class="section__title" style="margin-bottom:.25rem;">{{ _('Finished!') }}</h2>
          <div class="typing-end__score">
            WPM: <span id="final-wpm">0</span>
          </div>
          <form id="score-form" method="post" action="/typing" style="margin-top:.5rem;">
            <input type="hidden" name="score" id="score-input">
            <button type="submit" class="rounded primary button">{{ _('Save score') }}</button>
          </form>
          <div style="margin-top:.5rem; color:#6b7280; font-size:.9rem;">
            <span>Chars: <span id="final-chars">0</span></span> ¬∑
            <span>Time: <span id="final-time">0.0</span>s</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Â±•Ê≠¥„Ç´„Éº„Éâ -->
    <div class="section">
      <div class="history-card">
        <div class="history-header">
          <h2 class="history-title">{{ _('History') }}</h2>
        </div>
        <div>
          {% if history and history.length %}
          <table class="history-table">
            <thead>
              <tr><th>{{ _('Date') }}</th><th>WPM</th></tr>
            </thead>
            <tbody id="history-body">
              {% for h in history %}
              <tr>
                <td class="js-date">{{ h.createdAt }}</td>
                <td><strong>{{ h.score }}</strong></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <div class="history-empty">„Åæ„Å†Â±•Ê≠¥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Â§ñÈÉ®JS -->
<script>
  // „Çµ„Éº„Éê„ÉºÂÅ¥„Åã„Çâ„Éá„Éº„ÇøÂèó„ÅëÂèñ„Çä
  const items = {{ words | safe }};
</script>
<script src="/public/typing.js"></script>

{% endblock %}
