{% extends "layout/basic.html" %}
{% block content %}

<!-- å¤–éƒ¨CSS -->
<link rel="stylesheet" href="/public/typing.css">

<div class="row">
  <div class="medium-12 columns">
    <!-- ã‚¿ã‚¤ãƒ”ãƒ³ã‚°æœ¬ä½“ -->
    <div class="section">
      <div class="section__header">
        <h1 class="section__title">{{ _('Typing Practice') }}</h1>
      </div>

      <div class="section__body typing-wrap">
        <div class="level-bar">
          <div class="level-tabs" role="tablist">
            <button class="level-tab is-active" data-level="beginner">åˆç´š</button>
            <button class="level-tab" data-level="intermediate">ä¸­ç´š</button>
            <button class="level-tab" data-level="advanced">ä¸Šç´š</button>
          </div>
          <div class="level-caption">
            <div id="level-title" class="level-title">åˆç´š Â· 30 words</div>
            <p id="level-description">0ã€œ300ã®å˜èªã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«å‡ºé¡Œã—ã¾ã™ã€‚</p>
          </div>
        </div>

        <!-- ğŸ”§ ã“ã“ã‹ã‚‰æ–°HUD -->
        <div class="hud-deck">
          <!-- ç™ºéŸ³ãƒˆã‚°ãƒ«ï¼ˆå·¦ï¼‰ -->
          <div class="badge-card" id="tts-card" title="ç™ºéŸ³ã®ON/OFF">
            <label class="toggle">
              <input id="tts-toggle" type="checkbox" checked>
              <span class="toggle-slider"></span>
            </label>
            <span class="badge-title">ğŸ”Š ç™ºéŸ³</span>
          </div>

          <!-- æ®‹ã‚Šå˜èªæ•°ï¼ˆå³ï¼‰ -->
          <div class="badge-card" id="left-card">
            <span class="badge-title">Left</span>
            <span id="hud-remaining" class="badge-count">- / -</span>
          </div>
        </div>
        <!-- ğŸ”§ ã“ã“ã¾ã§æ–°HUD -->

        <div class="typing-panel">
          <!-- å˜èªè¡¨ç¤º -->
          <div id="word-display" class="typing-word"></div>

          <!-- æ—¥æœ¬èªè¨³ -->
          <div id="meaning-display" class="typing-meaning"></div>

          <!-- çµ‚äº†ç”»é¢ -->
          <div id="end-screen" class="typing-end">
            <h2 class="section__title" style="margin-bottom:.25rem;">{{ _('Finished!') }}</h2>
            <div class="typing-end__score">
              WPM: <span id="final-wpm">0</span>
            </div>
            <form id="score-form" method="post" action="/typing" style="margin-top:.5rem;">
              <input type="hidden" name="score" id="score-input">
              <button type="submit" class="rounded primary button">{{ _('Save score') }}</button>
            </form>
            <div style="margin-top:.5rem; color:#6b7280; font-size:.9rem;">
              <span>Chars: <span id="final-chars">0</span></span> Â·
              <span>Time: <span id="final-time">0.0</span>s</span>
            </div>
            <button id="restart-btn" type="button" class="ghost-btn">åŒã˜ãƒ¬ãƒ™ãƒ«ã§ã‚‚ã†ä¸€åº¦</button>
          </div>
        </div>
        <div class="hint-row">
          <div class="hint-chip">ã‚¿ã‚¤ãƒ—é–‹å§‹ã§ã‚¿ã‚¤ãƒãƒ¼ãŒå‹•ãã¾ã™</div>
          <div class="hint-chip">Enterä¸è¦ã€æ­£è§£ã§æ¬¡ã«é€²ã¿ã¾ã™</div>
          <div class="hint-chip">ãƒ¬ãƒ™ãƒ«ã¯ã„ã¤ã§ã‚‚åˆ‡ã‚Šæ›¿ãˆå¯èƒ½</div>
        </div>
      </div>
    </div>

    <!-- å±¥æ­´ã‚«ãƒ¼ãƒ‰ -->
    <div class="section">
      <div class="history-card">
        <div class="history-header">
          <h2 class="history-title">{{ _('History') }}</h2>
        </div>
        <div>
          {% if history and history.length %}
          <table class="history-table">
            <thead>
              <tr>
                <th>{{ _('Date') }}</th>
                <th>WPM</th> <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚‚ã“ã®åˆ—ã«å…¥ã‚Œã‚‹ -->
              </tr>
            </thead>
            <tbody id="history-body">
              {% for h in history %}
              <tr>
                <td class="js-date">{{ h.createdAt }}</td>
                <td>
                  <span class="wpm-badge">{{ h.score }}</span>
                  <span class="history-actions">
                    <!-- ãƒ•ã‚©ãƒ¼ãƒ ã§å‰Šé™¤ï¼ˆJSä¸è¦ï¼‰ -->
                    <form method="post" action="/typing/delete" style="display:inline;">
                      <input type="hidden" name="id" value="{{ h._id }}">
                      <button type="submit" class="btn btn--ghost-danger">
                        <span class="icon-trash"></span> Delete
                      </button>
                    </form>
                  </span>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <div class="history-empty">ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>
          {% endif %}
        </div>
      </div>
    </div>

  </div>
</div>

<!-- å¤–éƒ¨JS -->
<script>
  // ã‚µãƒ¼ãƒãƒ¼å´ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å—ã‘å–ã‚Š
  const items = {{ words | safe }};
</script>
<script src="/public/typing.js"></script>

{% endblock %}